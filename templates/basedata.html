{% extends "base.html" %}
{% block css %}
    <!-- Editable CSS -->
    {% load static %}
    <link type="text/css" rel="stylesheet" href={% static "plugins/bower_components/jsgrid/dist/jsgrid.min.css" %}/>

    <link type="text/css" rel="stylesheet"
          href={% static "plugins/bower_components/jsgrid/dist/jsgrid-theme.min.css" %}/>

    <link href={% static "js/libs/datatables.net-bs4/css/dataTables.bootstrap4.css" %} rel="stylesheet">
    <link href={% static "js/libs/bootstrap-datepicker/dist/css/bootstrap-datepicker.standalone.min.css" %} rel="stylesheet">

    <style>
        .mytable-head-color {
            background-color: #ff684947;
            opacity: 0.7;
        }

        .mytable-head th {
            text-align: center;
            vertical-align: center;
        }

        .exportExcel {
            margin-bottom: 10px;
        }

    </style>

{% endblock %}

{% block breadcum %}
    <a href="#">{{ street_district }}普查数据</a>
{% endblock %}

{% block content %}

    <div class="row">
        <div class="col-lg-12">
            <div class="white-box">
                <h3 class="box-title ">普查数据
                    {#                    <button class="btn btn-success waves-effect waves-light pull-right" type="button"><span#}
                    {#                            class="btn-label"><i class="fa fa-check"></i></span>导出EXCEL#}
                    {#                    </button>#}
                </h3>
                <h4>
                </h4>
                {#                <a href="{% url 'edit_com' '1' %}">click</a>#}

                <div class="col-12">
                    <div class="card">
                        <div class="card-body">
                            <h6 class="card-title btn btn-success" id="on-click-search"
                                style="color: #fff; margin-bottom: 5px;">高级搜索</h6>
                            <form class="form-horizontal">
                                <div class="card-body  search-list">

                                    <div class="row">
                                        <div class="col-sm-12 col-md-3 col-lg-3">
                                            <div class="form-group row">
                                                <label for="fname2"
                                                       class="col-sm-4 text-right control-label col-form-label">单位名称</label>
                                                <div class="col-sm-8">
                                                    <div id="name_search"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-sm-12 col-md-3 col-lg-3">
                                            <div class="form-group row">
                                                <label for="fname2"
                                                       class="col-sm-4 text-right control-label col-form-label">社会信用代码</label>
                                                <div class="col-sm-8">
                                                    <div id="id_search"></div>
                                                </div>
                                            </div>
                                        </div>
{#                                        <div class="col-sm-12 col-md-3 col-lg-3">#}
{#                                            <div class="form-group row">#}
{#                                                <label for="fname2"#}
{#                                                       class="col-sm-4 text-right control-label col-form-label">完成审核</label>#}
{#                                                <div class="col-sm-8">#}
{#                                                    <div id="complete_done_search"></div>#}
{#                                                </div>#}
{#                                            </div>#}
{#                                        </div>#}
                                        <div class="col-sm-12 col-md-3 col-lg-3">
                                            <div class="form-group row">
                                                <label for="fname2"
                                                       class="col-sm-4 text-right control-label col-form-label">社区</label>
                                                <div class="col-sm-8">
                                                    <div id="community_search"></div>
                                                </div>
                                            </div>
                                        </div>
{#                                        <div class="col-sm-12 col-md-3 col-lg-3">#}
{#                                            <div class="form-group row">#}
{#                                                <label for="fname2"#}
{#                                                       class="col-sm-4 text-right control-label col-form-label">单位类型</label>#}
{#                                                <div class="col-sm-8">#}
{#                                                    <div id="comp_type_search"></div>#}
{#                                                </div>#}
{#                                            </div>#}
{#                                        </div>#}

                                        <div class="col-sm-12 col-md-3 col-lg-3">
                                            <div class="form-group row">
                                                <label for="nname"
                                                       class="col-sm-4 text-right control-label col-form-label"></label>
                                                <div class="col-sm-8">
                                                    <input type="button" value="清空所有搜索条件" id="btn_reset"
                                                           class="btn btn-block btn-outline btn-danger">
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                </div> <!-- end of saercch card -->
                                <hr style="margin-top: 0px;">
                            </form>
                        </div>
                        <div class="card-body">


                            <div class="table-responsive" style="font-size: small">


                                <table id="file_export" cellspacing="0" width="100%"
                                       class="table display compact table-striped table-bordered datatable-select-inputs">
                                    <thead class="text-white">
                                    <tr class="mytable-head mytable-head-color">

                                        <th rowspan="2">完成审核</th>
                                        <th rowspan="2">统一社会信用代码</th>
                                        {% comment %} <th rowspan="2">企业规模</th> {% endcomment %}
                                        <th rowspan="2" class="comp-name">公司名称</th>
                                        <th rowspan="2">单位地址</th>
                                        <th rowspan="2">所属街道</th>
                                        <th rowspan="2">所属社区</th>
                                        <th rowspan="2">联系人</th>
                                        <th rowspan="2">联系电话</th>
                                        <th rowspan="2">单位类型</th>
                                        <th rowspan="2">会计制度</th>
                                        <th rowspan="2">业务活动</th>
                                        <th rowspan="2">611</th>
                                        <th colspan="1">多产法人</th>
                                        <th rowspan="2">611-2</th>
                                        <th rowspan="2">611-4</th>
                                        <th colspan="3">主要经济指标表种</th>
                                        <th rowspan="2">id</th>
                                        <th rowspan="2"></th>
                                        <th rowspan="2"></th>
                                        <th rowspan="2"></th>
                                        <th rowspan="2"></th>
                                        <th rowspan="2"></th>
                                        <th rowspan="2"></th>
                                        <th rowspan="2"></th>
                                    </tr>

                                    <tr class="mytable-head-color">
                                        <th>
                                            611-1
                                        </th>
                                        <th>
                                            611-3
                                        </th>
                                        <th>
                                            611-5
                                        </th>
                                        <th>
                                            611-6
                                        </th>
                                    </tr>
                                    </thead>

                                    <tbody>

                                    {#                                    {% for d in data %}#}
                                    {#                                        <tr>#}
                                    {#                                            <td>{% if d.is_notice == False %}否{% else %}是{% endif %}</td>#}
                                    {#                                            <td>{% if d.social_num %} {{ d.social_num }} {% else %}{% endif %}</td>#}
                                    {#                                            {% comment %} <td>{{ d.get_legal_unite_company_size_display }}</td> {% endcomment %}#}
                                    {#                                            <td class="comp-id"><a href="{% url 'edit_com' d.id %}">{{ d.name }}</a>#}
                                    {#                                            </td>#}
                                    {#                                            <td>{{ d.address }}</td>#}
                                    {#                                            <td>{{ d.street_district }}</td>#}
                                    {#                                            <td>{{ d.community }}</td>#}
                                    {#                                            <td></td>#}
                                    {#                                            <td>{{ d.legal_person }}</td>#}
                                    {#                                            <td>{{ d.mobile }}</td>#}
                                    {#                                            <td>{{ d.get_comp_type_display }}</td>#}
                                    {#                                            <td>{{ d.multi_branch }}</td>#}
                                    {#                                            <td>{{ d.get_accounting_rule_display }}</td>#}
                                    {#                                            <td>{{ d.main_activity_1 }}</td>#}
                                    {#                                            <td>#}
                                    {#                                                {% if d.need_611_2 == '是' %}#}
                                    {#                                                    {% if d.done_611_2 == True %}#}
                                    {#                                                        <a href="{% url 'edit_611_2' d.id %}"><i#}
                                    {#                                                                class="fa fa-check-square-o" aria-hidden="true"></i></a>#}
                                    {#                                                    {% else %}#}
                                    {#                                                        <a href="{% url 'edit_611_2' d.id %}"><i class="fa fa-square-o"#}
                                    {#                                                                                                 aria-hidden="true"></i></a>#}
                                    {#                                                    {% endif %}#}
                                    {##}
                                    {#                                                {% endif %}#}
                                    {#                                            </td>#}
                                    {#                                            <td>#}
                                    {#                                                {% if d.need_611_4 == '是' %}#}
                                    {#                                                    {% if d.done_611_4 == True %}#}
                                    {#                                                        <a href="{% url 'edit_611_4' d.id %}"><i#}
                                    {#                                                                class="fa fa-check-square-o" aria-hidden="true"></i></a>#}
                                    {#                                                    {% else %}#}
                                    {#                                                        <a href="{% url 'edit_611_4' d.id %}"><i class="fa fa-square-o"#}
                                    {#                                                                                                 aria-hidden="true"></i></a>#}
                                    {#                                                    {% endif %}#}
                                    {##}
                                    {#                                                {% endif %}#}
                                    {#                                            </td>#}
                                    {#                                            <td>#}
                                    {#                                                {% if d.need_611_1 == '是' %}#}
                                    {#                                                    {% if d.done_611_1 == True %}#}
                                    {#                                                        <a href="{% url 'edit_611_1' d.id %}"><i#}
                                    {#                                                                class="fa fa-check-square-o" aria-hidden="true"></i></a>#}
                                    {#                                                    {% else %}#}
                                    {#                                                        <a href="{% url 'edit_611_1' d.id %}"><i class="fa fa-square-o"#}
                                    {#                                                                                                 aria-hidden="true"></i></a>#}
                                    {#                                                    {% endif %}#}
                                    {##}
                                    {#                                                {% endif %}#}
                                    {#                                            </td>#}
                                    {#                                            <td>#}
                                    {#                                                {% if d.need_611_3 == '是' %}#}
                                    {#                                                    {% if d.done_611_3 == True %}#}
                                    {#                                                        <a href="{% url 'edit_611_3' d.id %}"><i#}
                                    {#                                                                class="fa fa-check-square-o" aria-hidden="true"></i></a>#}
                                    {#                                                    {% else %}#}
                                    {#                                                        <a href="{% url 'edit_611_3' d.id %}"><i class="fa fa-square-o"#}
                                    {#                                                                                                 aria-hidden="true"></i></a>#}
                                    {#                                                    {% endif %}#}
                                    {##}
                                    {#                                                {% endif %}#}
                                    {#                                            </td>#}
                                    {#                                            <td>#}
                                    {#                                                {% if d.need_611_5 == '是' %}#}
                                    {#                                                    {% if d.done_611_5 == True %}#}
                                    {#                                                        <a href="{% url 'edit_611_5' d.id %}"><i#}
                                    {#                                                                class="fa fa-check-square-o" aria-hidden="true"></i></a>#}
                                    {#                                                    {% else %}#}
                                    {#                                                        <a href="{% url 'edit_611_5' d.id %}"><i class="fa fa-square-o"#}
                                    {#                                                                                                 aria-hidden="true"></i></a>#}
                                    {#                                                    {% endif %}#}
                                    {##}
                                    {#                                                {% endif %}#}
                                    {#                                            </td>#}
                                    {#                                            <td>#}
                                    {#                                                {% if d.need_611_6 == '是' %}#}
                                    {#                                                    {% if d.done_611_6 == True %}#}
                                    {#                                                        <a href="{% url 'edit_611_6' d.id %}"><i#}
                                    {#                                                                class="fa fa-check-square-o" aria-hidden="true"></i></a>#}
                                    {#                                                    {% else %}#}
                                    {#                                                        <a href="{% url 'edit_611_6' d.id %}"><i class="fa fa-square-o"#}
                                    {#                                                                                                 aria-hidden="true"></i></a>#}
                                    {#                                                    {% endif %}#}
                                    {##}
                                    {#                                                {% endif %}#}
                                    {#                                            </td>#}
                                    {#                                        </tr>#}
                                    {#                                    {% endfor %}#}
                                    </tbody>
                                </table>

                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>


{% endblock %}

{% block js %}
    {% load static %}
    <script src={% static "js/DataTables/datatables.min.js" %}></script>
    <script src="https://cdn.datatables.net/buttons/1.5.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.1/js/buttons.flash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.1/js/buttons.html5.min.js"></script>
    <script src={% static "js/libs/bootstrap-datepicker/dist/js/bootstrap-datepicker.min.js" %} charset="UTF-8"></script>
    <script src={% static "js/DataTables/jquery.dataTables.yadcf.js" %}></script>

    <!-- Editable -->
    {#    <script src={% static "plugins/bower_components/jsgrid/db.js" %}></script>#}
    {#    <script type="text/javascript" src={% static "plugins/bower_components/jsgrid/dist/jsgrid.min.js" %}></script>#}
    {#    <script src={% static "js/jsgrid-init.js" %}></script>#}
    <script src={% static "js/xianmeng/jsgrid.js" %}></script>

    <script>
        $(document).ready(function () {

            //显示隐藏高级搜索项
            $('.search-list').hide();
            $('#on-click-search').click(function () {
                $('.search-list').toggle();
            })


            var mytable = $('#file_export').DataTable(
                {
                    "dom": '<"top"lBi>rt<"bottom"p><"clear">',
                    "processing": true,
                    "deferRender": true,
                    "lengthMenu": [[25, 50, 100, -1], [25, 50, 100, "全部"]],
                    "iDisplayLength": 25,
                    "scrollX": true,
                    "scrollY": false,
                    scroller: {
                        loadingIndicator: true
                    },
                    "scrollCollapse": true,
                    "fixedColumns": true,
                    "language": {
                        "search": "搜索",
                        "info": "显示 _START_ 至 _END_ 共 _TOTAL_ 条记录",
                        "processing": "努力加载中",
                        {#"loadingRecords": "<img src={% static 'assets/images/giphy.gif'%} width='50'/>",#}
                        "zeroRecords": "很抱歉，没有找到符合您搜索条件的记录",
                        "lengthMenu": "每页显示 _MENU_ 条",
                        "paginate": {
                            "next": "下一页",
                            "previous": "前一页"
                        }
                    },
                    "buttons": [
                        {#{#}
                        {#    'extend': 'excelHtml5',#}
                        {#    'text': '导出excel',//定义导出excel按钮的文字#}
                        {#    'exportOptions': {#}
                        {#        'modifier': {#}
                        {#            'page': 'current'#}
                        {#        }#}
                        {#    }},#}

                        {% if permission == True %}
                            {
                                'text': '新建数据',
                                'action': function () {
                                    window.location.href = '/edit_com/{{ street_district }}/0/'
                                }
                            }
                        {% endif %}

                    ],
                    "serverSide": true,
                    "ajax": {
                        {% if user.is_admin == True %}
                            url: "/api/companyList/?format=datatables&is_valid=true&street_district=" + '{{ street_district }}',
                        {% else %}
                            url: "/api/companyList/?format=datatables&is_valid=true&(added_by=" + '{{ user.id }}' + "|modified_by=" + '{{ system_user }}' + ")&street_district=" + '{{ street_district }}',
                        {% endif %}
                        error: function () {
                            console.log("暂无数据")
                        }

                    },
                    searching: true,
                    columns: [
                        {                                                                                           //0
                            'data': 'complete_done',
                            'render': function (data, type, row) {
                                if (data == false) {
                                    return '未完成'
                                }
                                else {
                                    return '已完成'
                                }
                            },
                            'complete_done': 'complete_done',
                        },
                        {data: 'social_num', 'social_num': 'social_num'},                                           //1
                        {
                            'data': 'name',
                            'render': function (data, type, row) {
                                return '<a href="/edit_com/' + row.street_district + '/' + row.id + '">' + data + '</a>'
                            },
                            'name': 'name',
                        },
                        {data: 'address', 'address': 'address'},                                                    //2
                        {data: 'street_district', 'street_district': 'street_district'},                            //3                                      //3
                        {data: 'community', 'community': 'community'},                                              //4
                        {data: 'legal_person', 'legal_person': 'legal_person'},                                     //5
                        {data: 'mobile', 'mobile': 'mobile'},                                                       //6
                        {
                            data: 'comp_type',
                            'render': function (data, type, row) {
                                if (data == '1') {
                                    return '法人单位'
                                }
                                if (data == '2') {
                                    return '产业活动单位'
                                }
                            },
                            'comp_type': 'comp_type'
                        },                                              //7
                        {
                            data: 'accounting_rule',
                            'render': function (data, type, row) {

                                switch (data) {
                                    case('1'):
                                        accounting = '企业会计制度'
                                        break;
                                    case('2'):
                                        accounting = '事业单位会计制度'
                                        break;
                                    case('3'):
                                        accounting = '行政单位会计制度'
                                        break;
                                    case('4'):
                                        accounting = '民间非营利组织会计制度'
                                        break;
                                    default:
                                        accounting = '其他'
                                }
                                return accounting
                            },
                            'accounting_rule': 'accounting_rule'
                        },                            //8                                      //3
                        {data: 'main_activity_1', 'main_activity_1': 'main_activity_1'},                            //9                                      //3

                        {                                                                                           //10
                            'data': 'done_611',
                            'render': function (data, type, row) {
                                if (data == true) {
                                    return '<a href="/edit_com/' + row.street_district + '/' + row.id + '"><i class="fa fa-check-square-o" aria-hidden="true"></i></a>'
                                }
                                else {
                                    return '<a href="/edit_com/' + row.street_district + '/' + row.id + '"><i class="fa fa-square-o" aria-hidden="true"></i></a>'

                                }
                            },
                            'done_611': 'done_611',
                        },
                        {
                            data: 'need_611_1',
                            'render': function (data, type, row) {

                                if (data == true) {
                                    if (row.done_611_1 == true) {
                                        return '<a href="/edit_611_1/' + row.id + '"><i class="fa fa-check-square-o" aria-hidden="true"></i></a>'
                                    } else {
                                        return '<a href="/edit_611_1/' + row.id + '"><i class="fa fa-square-o" aria-hidden="true"></i></a>'

                                    }

                                }
                                else {
                                    return ``
                                }
                            },
                            'need_611_1': 'need_611_1'
                        },                                          //11
                        {
                            data: 'need_611_2',
                            'render': function (data, type, row) {
                                if (data == true) {
                                    if (row.done_611_2 == true) {
                                        return '<a href="/edit_611_2/' + row.id + '"><i class="fa fa-check-square-o" aria-hidden="true"></i></a>'
                                    } else {
                                        return '<a href="/edit_611_2/' + row.id + '"><i class="fa fa-square-o" aria-hidden="true"></i></a>'

                                    }
                                }
                                else {
                                    return ``
                                }
                            }, 'need_611_2': 'need_611_2'
                        },                                          //12
                        {
                            data: 'need_611_4',
                            'render': function (data, type, row) {

                                if (data == true) {
                                    if (row.done_611_4 == true) {
                                        return '<a href="/edit_611_4/' + row.id + '"><i class="fa fa-check-square-o" aria-hidden="true"></i></a>'
                                    } else {
                                        return '<a href="/edit_611_4/' + row.id + '"><i class="fa fa-square-o" aria-hidden="true"></i></a>'
                                    }
                                }
                                else {
                                    return ``
                                }
                            }, 'need_611_4': 'need_611_4'
                        },                                           //13
                        {
                            data: 'need_611_3',
                            'render': function (data, type, row) {
                                if (data == true) {
                                    if (row.done_611_3 == true) {
                                        return '<a href="/edit_611_3/' + row.id + '"><i class="fa fa-check-square-o" aria-hidden="true"></i></a>'
                                    } else {
                                        return '<a href="/edit_611_3/' + row.id + '"><i class="fa fa-square-o" aria-hidden="true"></i></a>'
                                    }
                                }
                                else {
                                    return ``
                                }
                            }, 'need_611_3': 'need_611_3'
                        },                                            //14
                        {
                            data: 'need_611_5',
                            'render': function (data, type, row) {
                                if (data == true) {
                                    if (row.done_611_5 == true) {
                                        return '<a href="/edit_611_5/' + row.id + '"><i class="fa fa-check-square-o" aria-hidden="true"></i></a>'
                                    } else {
                                        return '<a href="/edit_611_5/' + row.id + '"><i class="fa fa-square-o" aria-hidden="true"></i></a>'
                                    }
                                }
                                else {
                                    return ``
                                }
                            }, 'need_611_5': 'need_611_5'
                        },                                             //15
                        {
                            data: 'need_611_6',
                            'render': function (data, type, row) {

                                if (data == true) {
                                    if (row.done_611_6 == true) {
                                        return '<a href="/edit_611_6/' + row.id + '"><i class="fa fa-check-square-o" aria-hidden="true"></i></a>'
                                    } else {
                                        return '<a href="/edit_611_6/' + row.id + '"><i class="fa fa-square-o" aria-hidden="true"></i></a>'
                                    }
                                }
                                else {
                                    return ``
                                }
                            }, 'need_611_6': 'need_611_6'
                        },                                             //16
                        {data: 'id'},                                              //17
                        {data: 'done_611'},                                             //17
                        {data: 'done_611_1'},                                              //17
                        {data: 'done_611_2'},                                             //17
                        {data: 'done_611_3'},                                              //17
                        {data: 'done_611_4'},                                              //17
                        {data: 'done_611_5'},                                              //17
                        {data: 'done_611_6'}                                              //17

                    ],
                }
            );
            mytable.columns([18, 19, 20, 21, 22, 23, 24, 25]).visible(false);
            $('.buttons-excel').addClass('btn  btn-default btn-outline btn-danger pull-right exportExcel');
            $('.dt-button').addClass('btn  btn-default btn-outline btn-danger pull-right');
            // Apply the search
            {#点击每行进入填表系统#}
            $('#file_export tbody').on('click', 'tr .comp-id', function () {
                var data = mytable.row(this).data();
                {#window.location.replace('/edit_com/');#}
            });
            yadcf.init(mytable, [
                    {
                        column_number: 0,
                        column_data_type: "html",
                        style_class: "form-control",
                        html_data_type: "text",
                        data: ["未完成", "已完成"],
                        filter_default_label: "请选择",
                        filter_container_selector: '#complete_done_search',
                        filter_reset_button_text: false
                    },

                    {
                        column_number: 1,
                        filter_type: "text",
                        style_class: "form-control",
                        filter_default_label: "请输入社会信用代码",
                        filter_container_id: 'id_search',
                        filter_reset_button_text: false
                    },
                    {
                        column_number: 2,
                        filter_type: "text",
                        style_class: "form-control",
                        filter_default_label: "请输入企业名称",
                        filter_container_id: 'name_search',
                        filter_reset_button_text: false
                    },

                    {
                        column_number: 5,
                        filter_type: "text",
                        style_class: "form-control",
                        filter_default_label: "请输入社区",
                        filter_container_id: 'community_search',
                        filter_reset_button_text: false
                    },

                    {
                        column_number: 8,
                        column_data_type: "html", style_class: "form-control",
                        html_data_type: "text", data: ["法人单位", "产业活动单位"], filter_default_label: "请选择",
                        filter_container_selector: '#comp_type_search',
                        filter_reset_button_text: false
                    },

                ]
            );
            $('#btn_reset').on('click', function (e) {
                yadcf.exResetAllFilters(mytable);
            });
        });


    </script>
{% endblock %}